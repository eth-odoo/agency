<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Agency Base Template - WITH TRANSLATIONS -->
        <template id="agency_base_template" name="Agency Base Template">
            <html>
                <head>
                    <meta charset="utf-8"/>
                    <meta name="viewport" content="width=device-width, initial-scale=1"/>
                    <title>Agency Portal</title>
                    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
                    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
                    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
                    <style>
                        .agency-header {
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white;
                            padding: 1rem 0;
                            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
                        }
                        .agency-sidebar {
                            background: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);
                            min-height: calc(100vh - 76px);
                            border-right: 1px solid #dee2e6;
                        }
                        .content-area {
                            padding: 2rem;
                            background-color: #f8f9fa;
                        }
                        .nav-link {
                            transition: all 0.3s ease;
                            border-radius: 8px;
                            color: #495057;
                            text-decoration: none;
                        }
                        .nav-link:hover {
                            background-color: rgba(102, 126, 234, 0.1);
                            transform: translateX(5px);
                            color: #667eea;
                        }
                        .nav-link.has-submenu {
                            position: relative;
                        }
                        .nav-link.has-submenu::after {
                            content: '\f107';
                            font-family: 'Font Awesome 6 Free';
                            font-weight: 900;
                            position: absolute;
                            right: 15px;
                            top: 50%;
                            transform: translateY(-50%);
                            transition: transform 0.3s;
                        }
                        .nav-link.has-submenu.collapsed::after {
                            transform: translateY(-50%) rotate(-90deg);
                        }
                        .submenu {
                            padding-left: 20px;
                            margin-top: 5px;
                        }
                        .submenu .nav-link {
                            font-size: 0.9rem;
                            padding: 8px 15px;
                            border-left: 2px solid #e9ecef;
                            margin-bottom: 2px;
                        }
                        .submenu .nav-link:hover {
                            border-left-color: #667eea;
                            background-color: rgba(102, 126, 234, 0.05);
                        }
                        .submenu .nav-link.active {
                            border-left-color: #667eea;
                            background-color: rgba(102, 126, 234, 0.1);
                            color: #667eea;
                        }
                        .membership-badge {
                            font-size: 0.75rem;
                            background: rgba(255,255,255,0.2);
                            padding: 2px 8px;
                            border-radius: 12px;
                        }
                        .language-selector {
                            background: rgba(255, 255, 255, 0.2);
                            border: 1px solid rgba(255, 255, 255, 0.4);
                            color: white;
                            padding: 4px 10px;
                            border-radius: 4px;
                            font-size: 0.9rem;
                            margin-right: 15px;
                        }
                        .language-selector option {
                            background-color: #6c757d;
                            color: white;
                        }
                    </style>
                    <t t-raw="head"/>
                </head>
                <body>
                    <!-- Header -->
                    <div class="agency-header">
                        <div class="container-fluid">
                            <div class="row align-items-center">
                                <div class="col-md-6">
                                    <h4 class="mb-0 fw-bold">
                                        <i class="fas fa-building me-2"></i>
                                        <span t-translate="">Agency Portal</span>
                                        <t t-if="agency_data">
                                            <t t-foreach="agency_data.get('membership_purposes', [])" t-as="purpose">
                                                <span class="membership-badge"><t t-esc="purpose"/></span>
                                            </t>
                                        </t>
                                    </h4>
                                </div>
                                <div class="col-md-6 text-end">
                                    <t t-if="user_data">
                                        <select id="language-selector" class="language-selector agency-language-switcher">
                                            <t t-if="available_languages">
                                                <t t-foreach="available_languages" t-as="lang">
                                                    <option t-att-value="lang[0]"><t t-esc="lang[1]"/></option>
                                                </t>
                                            </t>
                                        </select>

                                        <span class="me-3">
                                            <i class="fas fa-user me-1"></i>
                                            <span t-translate=""><t t-esc="user_data.get('name', 'User')"/></span>
                                        </span>
                                        <a href="/agency/logout" class="btn btn-outline-light btn-sm">
                                            <i class="fas fa-sign-out-alt me-1"></i>
                                            <span t-translate="">Logout</span>
                                        </a>
                                    </t>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="container-fluid">
                        <div class="row">
                            <!-- Sidebar -->
                            <div class="col-md-2 agency-sidebar p-3">
                                <nav class="nav flex-column">
                                    <a class="nav-link" href="/agency/dashboard">
                                        <i class="fas fa-tachometer-alt me-2"></i>
                                        <span t-translate="">Dashboard</span>
                                    </a>

                                    <a class="nav-link" href="/agency/users">
                                        <i class="fas fa-users me-2"></i>
                                        <span t-translate="">User Management</span>
                                    </a>

                                    <t t-if="agency_data and agency_data.get('has_sales', False)">
                                        <a class="nav-link has-submenu" data-bs-toggle="collapse" href="#bookingSubMenu" role="button" aria-expanded="false" aria-controls="bookingSubMenu">
                                            <i class="fas fa-hotel me-2"></i>
                                            <span class="menu-text" t-translate="">
                                                Booking Management
                                            </span>
                                        </a>

                                        <div class="collapse submenu" id="bookingSubMenu">
                                            <a class="nav-link" href="/agency/hotel-bookings">
                                                <i class="fas fa-bed me-2"></i>
                                                <span class="menu-text" t-translate="">
                                                    Hotel Bookings
                                                </span>
                                            </a>
                                        </div>
                                    </t>

                                    <t t-if="agency_data and agency_data.get('has_bonus', False)">
                                        <a class="nav-link has-submenu" data-bs-toggle="collapse" href="#bonusSubMenu" role="button" aria-expanded="false" aria-controls="bonusSubMenu">
                                            <i class="fas fa-star me-2"></i>
                                            <span class="menu-text" t-translate="">
                                                Bonus Management
                                            </span>
                                        </a>

                                        <div class="collapse submenu" id="bonusSubMenu">
                                            <a class="nav-link" href="/agency/bonus-reservation">
                                                <i class="fas fa-ticket me-2"></i>
                                                <span class="menu-text" t-translate="">
                                                    Bonus Reservations
                                                </span>
                                            </a>

                                            <a class="nav-link" href="/agency/bonus-wallet">
                                                <i class="fas fa-wallet me-2"></i>
                                                <span class="menu-text" t-translate="">
                                                    Bonus Wallet
                                                </span>
                                            </a>
                                        </div>
                                    </t>

                                    <t t-if="agency_data and agency_data.get('has_tickets', False)">
                                        <a class="nav-link has-submenu" data-bs-toggle="collapse" href="#ticketSubMenu" role="button" aria-expanded="false" aria-controls="ticketSubMenu">
                                            <i class="fas fa-ticket-alt me-2"></i>
                                            <span class="menu-text" t-translate="">
                                                Ticket Management
                                            </span>
                                        </a>

                                        <div class="collapse submenu" id="ticketSubMenu">
                                            <a class="nav-link" href="/agency/tickets">
                                                <i class="fas fa-tags me-2"></i>
                                                <span class="menu-text" t-translate="">
                                                    Tickets
                                                </span>
                                            </a>
                                        </div>
                                    </t>

                                    <a class="nav-link" href="/agency/reports">
                                        <i class="fas fa-chart-line me-2"></i>
                                        <span t-translate="">Reports</span>
                                    </a>

                                    <a class="nav-link" href="/agency/settings">
                                        <i class="fas fa-cog me-2"></i>
                                        <span t-translate="">Settings</span>
                                    </a>
                                </nav>
                            </div>

                            <!-- Main Content -->
                            <div class="col-md-10 content-area">
                                <t t-raw="0"/>
                            </div>
                        </div>
                    </div>

                    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
                    <script>
                        window.currentLanguage = '<t t-esc="current_language"/>';
                        $(document).ready(function() {
                            if (window.currentLanguage) {
                                $('#language-selector').val(window.currentLanguage);
                            }

                            $('#language-selector').on('change', function() {
                                var langCode = $(this).val();
                                $.ajax({
                                    url: '/agency/change-language',
                                    type: 'POST',
                                    dataType: 'json',
                                    contentType: 'application/json',
                                    data: JSON.stringify({
                                        'jsonrpc': '2.0',
                                        'method': 'call',
                                        'params': {'lang_code': langCode},
                                        'id': Date.now()
                                    }),
                                    success: function(result) {
                                        if (result.result &amp;&amp; result.result.success) {
                                            window.location.reload();
                                        }
                                    }
                                });
                            });
                        });
                    </script>
                </body>
            </html>
        </template>

        <!-- Access Denied Template -->
        <template id="agency_access_denied" name="Agency Access Denied">
            <t t-call="eth_agency_portal.agency_base_template">
                <div class="container">
                    <div class="row justify-content-center mt-5">
                        <div class="col-md-8">
                            <div class="alert alert-danger">
                                <h4 class="alert-heading">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    <span t-translate="">Access Denied</span>
                                </h4>
                                <p class="mb-0"><t t-esc="message"/></p>
                            </div>
                            <a href="/agency/dashboard" class="btn btn-primary">
                                <i class="fas fa-arrow-left me-2"></i>
                                <span t-translate="">Back to Dashboard</span>
                            </a>
                        </div>
                    </div>
                </div>
            </t>
        </template>
    </data>
</odoo>
