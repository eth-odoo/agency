<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Hotel Bookings Page Template -->
        <template id="agency_hotel_bookings" name="Agency Hotel Bookings">
            <t t-call="eth_agency_portal.agency_base_template">
                <t t-set="head">
                    <style>
                        .stats-card {
                            border-radius: 10px;
                            transition: transform 0.2s;
                        }
                        .stats-card:hover {
                            transform: translateY(-2px);
                        }
                        .room-card {
                            border: 1px solid #dee2e6;
                            border-radius: 10px;
                            margin-bottom: 15px;
                            transition: box-shadow 0.2s;
                        }
                        .room-card:hover {
                            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                        }
                        .rate-option {
                            border: 1px solid #e9ecef;
                            border-radius: 8px;
                            padding: 12px;
                            margin-bottom: 10px;
                            cursor: pointer;
                            transition: all 0.2s;
                        }
                        .rate-option:hover {
                            background-color: #f8f9fa;
                            border-color: #667eea;
                        }
                        .rate-option.selected {
                            background-color: rgba(102, 126, 234, 0.1);
                            border-color: #667eea;
                        }
                        .booking-state {
                            padding: 4px 10px;
                            border-radius: 12px;
                            font-size: 0.8rem;
                            font-weight: 500;
                        }
                        .booking-state.pending { background-color: #fff3cd; color: #856404; }
                        .booking-state.confirmed { background-color: #d4edda; color: #155724; }
                        .booking-state.cancelled { background-color: #f8d7da; color: #721c24; }
                        .booking-state.completed { background-color: #cce5ff; color: #004085; }
                    </style>
                </t>

                <div class="container-fluid">
                    <div class="row">
                        <div class="col-12">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h2>
                                    <i class="fas fa-hotel me-2"></i>
                                    Hotel Bookings
                                </h2>
                                <button class="btn btn-primary" onclick="openNewBookingModal()">
                                    <i class="fas fa-plus me-2"></i>
                                    New Hotel Booking
                                </button>
                            </div>

                            <!-- Stats Cards -->
                            <div class="row mb-4">
                                <div class="col-md-3">
                                    <div class="card stats-card bg-primary text-white">
                                        <div class="card-body">
                                            <h6 class="card-title">Total Bookings</h6>
                                            <h2 id="stat-total">0</h2>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card stats-card bg-warning text-dark">
                                        <div class="card-body">
                                            <h6 class="card-title">Pending</h6>
                                            <h2 id="stat-pending">0</h2>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card stats-card bg-success text-white">
                                        <div class="card-body">
                                            <h6 class="card-title">Confirmed</h6>
                                            <h2 id="stat-confirmed">0</h2>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card stats-card bg-info text-white">
                                        <div class="card-body">
                                            <h6 class="card-title">Available Bonus</h6>
                                            <h2 id="stat-bonus">
                                                <t t-esc="wallet_balance" t-if="wallet_balance"/>
                                                <t t-else="">0</t>
                                            </h2>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Bookings Table -->
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0">Recent Bookings</h5>
                                    <button class="btn btn-sm btn-outline-primary" onclick="loadBookings()">
                                        <i class="fas fa-sync-alt"></i> Refresh
                                    </button>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="bookings-table">
                                            <thead>
                                                <tr>
                                                    <th>Booking No</th>
                                                    <th>Hotel</th>
                                                    <th>Room</th>
                                                    <th>Guest</th>
                                                    <th>Check-in</th>
                                                    <th>Check-out</th>
                                                    <th>Total</th>
                                                    <th>Bonus Used</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="bookings-tbody">
                                                <tr>
                                                    <td colspan="10" class="text-center text-muted py-4">
                                                        <i class="fas fa-spinner fa-spin fa-2x mb-2"></i>
                                                        <div>Loading bookings...</div>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- New Booking Modal - Search Form -->
                <div class="modal fade" id="newBookingModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header bg-primary text-white">
                                <h5 class="modal-title">
                                    <i class="fas fa-search me-2"></i>
                                    Search Hotel Rooms
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <!-- Search Form -->
                                <form id="hotelSearchForm" onsubmit="searchHotelRooms(event)">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Hotel *</label>
                                                <select class="form-select" id="search_hotel_id" required="required">
                                                    <option value="">Select Hotel</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Market *</label>
                                                <select class="form-select" id="search_market_id" required="required">
                                                    <option value="">Select Market</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label class="form-label">Check-in Date *</label>
                                                <input type="date" class="form-control" id="search_checkin" required="required"/>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label class="form-label">Check-out Date *</label>
                                                <input type="date" class="form-control" id="search_checkout" required="required"/>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="mb-3">
                                                <label class="form-label">Adults *</label>
                                                <input type="number" class="form-control" id="search_adults" min="1" max="6" value="2" required="required"/>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="mb-3">
                                                <label class="form-label">Children</label>
                                                <input type="number" class="form-control" id="search_children" min="0" max="4" value="0" onchange="updateChildAges()"/>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="mb-3">
                                                <label class="form-label">&#160;</label>
                                                <button type="submit" class="btn btn-primary w-100">
                                                    <i class="fas fa-search me-1"></i>
                                                    Search
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Child Ages -->
                                    <div class="row" id="childAgesContainer" style="display: none;">
                                        <div class="col-12">
                                            <label class="form-label">Child Ages</label>
                                            <div class="row" id="childAgesInputs">
                                            </div>
                                        </div>
                                    </div>
                                </form>

                                <!-- Search Progress -->
                                <div id="searchProgress" class="text-center py-4" style="display: none;">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                    <p class="mt-2">Searching available rooms...</p>
                                </div>

                                <!-- Search Results -->
                                <div id="searchResults" class="mt-4" style="display: none;">
                                    <h5 class="mb-3">
                                        <i class="fas fa-bed me-2"></i>
                                        Available Rooms
                                    </h5>
                                    <div id="roomResultsContainer">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Room Selection / Booking Form Modal -->
                <div class="modal fade" id="roomSelectionModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header bg-success text-white">
                                <h5 class="modal-title">
                                    <i class="fas fa-check-circle me-2"></i>
                                    Complete Booking
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <form id="bookingForm">
                                    <!-- Room Summary -->
                                    <div class="card mb-3 bg-light">
                                        <div class="card-body" id="selectedRoomSummary">
                                        </div>
                                    </div>

                                    <!-- Guest Information -->
                                    <h5 class="mb-3">Guest Information</h5>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Guest Name *</label>
                                                <input type="text" class="form-control" id="guest_name" required="required"/>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Guest Surname *</label>
                                                <input type="text" class="form-control" id="guest_surname" required="required"/>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Email</label>
                                                <input type="email" class="form-control" id="guest_email"/>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Phone</label>
                                                <input type="tel" class="form-control" id="guest_phone"/>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Bonus Usage -->
                                    <div class="card mb-3 bg-light">
                                        <div class="card-body">
                                            <div class="row align-items-center">
                                                <div class="col-md-6">
                                                    <h6><i class="fas fa-wallet me-2"></i>Use Bonus</h6>
                                                    <p class="mb-0 text-muted">
                                                        Available: <strong id="availableBonusAmount">0</strong> EUR
                                                    </p>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="input-group">
                                                        <input type="number" class="form-control" id="bonus_amount" min="0" value="0" step="0.01" onchange="updatePriceSummary()"/>
                                                        <span class="input-group-text">EUR</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Price Summary -->
                                    <div class="card bg-primary text-white">
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-6">
                                                    <p class="mb-1">Room Total:</p>
                                                    <p class="mb-1">Discount:</p>
                                                    <p class="mb-1">Bonus Used:</p>
                                                    <hr class="border-white"/>
                                                    <h5>Final Total:</h5>
                                                </div>
                                                <div class="col-6 text-end">
                                                    <p class="mb-1" id="summaryRoomTotal">0 EUR</p>
                                                    <p class="mb-1 text-success" id="summaryDiscount">-0 EUR</p>
                                                    <p class="mb-1 text-warning" id="summaryBonus">-0 EUR</p>
                                                    <hr class="border-white"/>
                                                    <h5 id="summaryFinalTotal">0 EUR</h5>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-3 mt-3">
                                        <label class="form-label">Special Requests</label>
                                        <textarea class="form-control" id="special_requests" rows="2"></textarea>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                    Cancel
                                </button>
                                <button type="button" class="btn btn-success" onclick="submitBooking()">
                                    <i class="fas fa-check me-2"></i>
                                    Confirm Booking
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Booking Detail Modal -->
                <div class="modal fade" id="bookingDetailModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header bg-info text-white">
                                <h5 class="modal-title">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Booking Details
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body" id="bookingDetailContent">
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>

                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
                <script src="/eth_agency_portal/static/src/js/hotel_bookings.js"></script>
            </t>
        </template>
    </data>
</odoo>
